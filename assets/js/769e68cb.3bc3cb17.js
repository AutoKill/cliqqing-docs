"use strict";(globalThis.webpackChunkcliqqing_docs=globalThis.webpackChunkcliqqing_docs||[]).push([[439],{5111:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"development/architecture","title":"Architecture","description":"High-level architecture documentation for the Cliqqing Discord bot.","source":"@site/docs/development/architecture.md","sourceDirName":"development","slug":"/development/architecture","permalink":"/cliqqing-docs/docs/development/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/autokill/cliqqing-docs/tree/main/docs/development/architecture.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Self-Roles Commands","permalink":"/cliqqing-docs/docs/commands/self-roles"},"next":{"title":"Contributing","permalink":"/cliqqing-docs/docs/development/contributing"}}');var l=i(4848),r=i(8453);const o={},d="Architecture",t={},c=[{value:"System Architecture",id:"system-architecture",level:2},{value:"Core Components",id:"core-components",level:2},{value:"Sapphire Framework Client",id:"sapphire-framework-client",level:3},{value:"Commands Module",id:"commands-module",level:3},{value:"Listeners Module",id:"listeners-module",level:3},{value:"Database Layer",id:"database-layer",level:3},{value:"Configuration System",id:"configuration-system",level:3},{value:"Data Flow",id:"data-flow",level:2},{value:"Welcome Message Flow",id:"welcome-message-flow",level:3},{value:"Self-Role Flow",id:"self-role-flow",level:3},{value:"Technology Stack",id:"technology-stack",level:2},{value:"Extension Points",id:"extension-points",level:2},{value:"Adding New Commands",id:"adding-new-commands",level:3},{value:"Adding New Listeners",id:"adding-new-listeners",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,l.jsx)(n.p,{children:"High-level architecture documentation for the Cliqqing Discord bot."}),"\n",(0,l.jsx)(n.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Discord API (WebSocket)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502\n                        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Sapphire Framework Client                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502   Commands   \u2502  \u2502  Listeners   \u2502  \u2502 Preconditions\u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502  \u2502 Cron Tasks   \u2502  \u2502   Utils      \u2502                   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502               \u2502               \u2502\n        \u25bc               \u25bc               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Prisma     \u2502 \u2502    Config    \u2502 \u2502   Plugins    \u2502\n\u2502   Client     \u2502 \u2502    System    \u2502 \u2502 (Logger/Cron)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      PostgreSQL (Neon Serverless)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(n.h2,{id:"core-components",children:"Core Components"}),"\n",(0,l.jsx)(n.h3,{id:"sapphire-framework-client",children:"Sapphire Framework Client"}),"\n",(0,l.jsx)(n.p,{children:"The bot is built on the Sapphire Framework, which provides:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Command System"}),": Automatic command loading and routing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Event Listeners"}),": Event-driven architecture for Discord events"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Dependency Injection"}),": Container-based service management"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Preconditions"}),": Command access control and validation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Plugin System"}),": Extensible architecture via plugins"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"commands-module",children:"Commands Module"}),"\n",(0,l.jsx)(n.p,{children:"Commands handle user interactions and bot functionality."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Commands extend ",(0,l.jsx)(n.code,{children:"ExtendedCommand"})," from ",(0,l.jsx)(n.code,{children:"#lib/extensions/ExtendedCommand"})]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"@ApplyOptions"})," decorator for configuration"]}),"\n",(0,l.jsxs)(n.li,{children:["Auto-loaded from ",(0,l.jsx)(n.code,{children:"src/commands/"})," directory"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Current Commands:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"welcome"}),": Welcome message management"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"selfroles"}),": Self-role system management"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"listeners-module",children:"Listeners Module"}),"\n",(0,l.jsx)(n.p,{children:"Listeners handle Discord events and bot lifecycle events."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Current Listeners:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"clientReady"}),": Bot startup initialization"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"guildMemberAdd"}),": Welcome message handling"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"messageReactionAdd"}),": Self-role assignment"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"messageReactionRemove"}),": Self-role removal"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"messageCommandDenied"}),": Command denial handling"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"messageCommandError"}),": Error handling"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"database-layer",children:"Database Layer"}),"\n",(0,l.jsx)(n.p,{children:"Prisma ORM provides type-safe database access."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Models:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Cooldown"}),": Rate limiting and cooldown management"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PingOnJoinData"}),": Welcome message configurations"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SelfRole"}),": Self-role configurations"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"configuration-system",children:"Configuration System"}),"\n",(0,l.jsx)(n.p,{children:"Custom configuration system with JSON/YAML support."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Features:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Auto-creation of default config files"}),"\n",(0,l.jsx)(n.li,{children:"Zod schema validation"}),"\n",(0,l.jsx)(n.li,{children:"Auto-merge with defaults"}),"\n",(0,l.jsx)(n.li,{children:"Support for JSON and YAML formats"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,l.jsx)(n.h3,{id:"welcome-message-flow",children:"Welcome Message Flow"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"User Joins Server\n    \u2502\n    \u25bc\nguildMemberAdd Listener\n    \u2502\n    \u25bc\nQuery PingOnJoinData (filter: guildId, paused=false)\n    \u2502\n    \u25bc\nFor each configuration:\n    \u2502\n    \u251c\u2500\u25ba Wait for delay\n    \u2502\n    \u251c\u2500\u25ba Fetch channel\n    \u2502\n    \u251c\u2500\u25ba Send message (member mention + custom message)\n    \u2502\n    \u2514\u2500\u25ba Schedule deletion (after duration)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"self-role-flow",children:"Self-Role Flow"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"User Reacts to Panel\n    \u2502\n    \u25bc\nmessageReactionAdd Listener\n    \u2502\n    \u25bc\nQuery SelfRole (filter: guildId, panelMessageId, emojiId)\n    \u2502\n    \u25bc\nIf found:\n    \u2502\n    \u251c\u2500\u25ba Check bot permissions\n    \u2502\n    \u251c\u2500\u25ba Assign role to user\n    \u2502\n    \u2514\u2500\u25ba Log action\n"})}),"\n",(0,l.jsx)(n.h2,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Runtime"}),": Bun"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Language"}),": TypeScript 5.7.3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Framework"}),": Sapphire Framework 5.3.7"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Discord API"}),": discord.js 14.24.1"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Database"}),": PostgreSQL (via Prisma 6.18.0)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Validation"}),": Zod 3.25.76"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"extension-points",children:"Extension Points"}),"\n",(0,l.jsx)(n.h3,{id:"adding-new-commands",children:"Adding New Commands"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Create file in ",(0,l.jsx)(n.code,{children:"src/commands/"})]}),"\n",(0,l.jsxs)(n.li,{children:["Extend ",(0,l.jsx)(n.code,{children:"ExtendedCommand"})]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"@ApplyOptions"})," for configuration"]}),"\n",(0,l.jsx)(n.li,{children:"Implement command logic"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"adding-new-listeners",children:"Adding New Listeners"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Create file in ",(0,l.jsx)(n.code,{children:"src/listeners/"})]}),"\n",(0,l.jsxs)(n.li,{children:["Extend ",(0,l.jsx)(n.code,{children:"Listener<typeof Events.EventName>"})]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"@ApplyOptions"})," for configuration"]}),"\n",(0,l.jsx)(n.li,{children:"Implement event handler"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsx)(n.p,{children:"For more detailed technical information, see the main project repository documentation."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var s=i(6540);const l={},r=s.createContext(l);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);